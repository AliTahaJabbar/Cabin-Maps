<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta http-equiv="Content-Security-Policy" content="
      default-src 'self' https:;
      script-src 'self' 'unsafe-eval' 'unsafe-inline' https://cdn.tailwindcss.com https://unpkg.com https://apis.google.com https://accounts.google.com;
      connect-src 'self' https://*.googleapis.com https://accounts.google.com;
     frame-src 'self' https://accounts.google.com;
    ">

    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="https://i.top4top.io/p_3450gatpo0.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>خدمات العصر الذكي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" xintegrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      /* Simple animations */
      @keyframes fade-in {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      @keyframes fade-in-up {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fade-in {
        animation: fade-in 0.5s ease-in-out;
      }
      .animate-fade-in-up {
        animation: fade-in-up 0.3s ease-in-out;
      }
      /* Styles for contentEditable elements */
      [contenteditable]:focus {
        outline: none;
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); /* Equivalent to ring-2 ring-blue-300 */
        border-radius: 6px;
      }
    </style>
    
    <!-- Local Libraries for React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

</head>
<body>
  <!-- Google APIs (gapi) -->
  <script src="https://apis.google.com/js/api.js"></script>

  <!-- Google Identity Services (token client) -->
  <script async defer src="https://accounts.google.com/gsi/client"></script>

    <div id="root"></div>
    <script type="text/babel">
       const { useState, useEffect, createContext, useContext, useCallback, useRef } = React;

      // --- From types.ts ---
      const Section = {
          Home: 'home',
          Maps: 'maps',
          Offers: 'offers',
          Vlans: 'vlans',
          Materials: 'materials',
          Maintenance: 'maintenance',
          Columns: 'columns',
          Contact: 'contact'
      };

      // --- From constants.ts ---
      const FOLLOWER_USERNAME = "متابع";
      const FOLLOWER_PASSWORD = "101001000";
      const ADMIN_USERNAME = "مسؤول";
      const DEFAULT_ADMIN_PASSWORD = "123456";

      const INITIAL_DATA = {
        offers: {
          "115": [
            {
              title: "العرض الاول لزون 115 الخاص بالاعمدة (1 / 2 / 3 / 4 / 5 / 6 / 7 / 8 / 9 / 10 / 11 / 12 / 13 / 39)",
              table: [
                ["شهر", "15,000", "20,000", "30,000", "75,000"],
                ["ثلاث اشهر", "55,000", "75,000", "120,000", "180,000"]
              ],
              note: "العرض الأول (بدون سوبرسيل): الكيبل مجاني | الجهاز الضوئي بـ5,000 | الڤيلان : 710"
            },
            {
              title: "العرض الثاني لزون 115 الخاص بالاعمدة (14 / 15 / 16 / 18 / 19 / 22 / 23 / 24 / 25 / 26 / 28 / 30 / 32 / 34 / 35 / 36 / 37 / 38 / 41)",
              table: [
                ["شهر", "15,000", "20,000", "30,000", "75,000"],
                ["شهرين", "مجاني", "لايوجد", "لايوجد", "لايوجد"],
                ["ثلاث اشهر", "20,000", "75,000", "120,000", "180,000"]
              ],
              note: "العرض الثاني (مُشترك مع سوبرسيل): الكيبل مجاني | الجهاز الضوئي 5,000 | الڤيلان : 710"
            }
          ],
          "سوبر سيل حكومي": [{
            title: "عرض سوبر سيل حكومي",
            table: [
              ["شهر", "38,000", "48,000", "68,000", "غير متوفر"],
              ["3 أشهر", "غير متوفر", "غير متوفر", "غير متوفر", "غير متوفر"],
            ],
            note: "السرعات المذكورة تشمل اشتراكات الوطني فقط | الكيبل بـ10,000 | الجهاز الضوئي بـ10,000 | الڤيلان : 10",
          }],
        },
        maps: [
          {
            name: "وطني الدور",
            link: "https://www.google.com/maps/d/edit?mid=1ZLaIWvkNGXWzXBtS2qn3QnuICsF4MLw",
          },
        ],
        vlans: {
          "151": "210",
          "235": "317",
          "مجمع": "2",
        },
        materials: {
          routers: [
            {
              name: "راوتر TP-link BE3000 Wifi 7",
              price: "السعر : 90.000 د.ع",
              image: "https://dc585.4shared.com/img/5YBFGXfZfa/s24/1993358aed0/_TP-link_BE3000_Wifi_7?async&rand=0.8962375215610101",
              specs: [
                "Wifi : الجيل السابع (الاحدث والاسرع) (Wifi 7)",
                "التغطية: ممتازة للمنازل المتوسطة إلى الكبيرة مع 4 هوائيات خارجية قوية",
                "السرعة: السرعة سلكياً : منفذ WAN بسرعة 2.5G و4 منافذ LAN المنفذ الأول بسرعة 2.5G والمنافذ الثلاث الباقية بسرعة 1G || السرعة الاسلكية : تصل تقريباً 3000Mbps  (574Mbps على 2.4GHz و2402Mbps على 5GHz).",
                "تحمّل الأجهزة: يدعم MU-MIMO، Beamforming وWPA3، لتوزيع أفضل للإشارة على أجهزة متعددة وتقليل التداخل.",
                " للألعاب والبث: أداء فائق جدًا للبث بدقة 4K وألعاب أونلاين بدون لاكَ أو تقطيع بفضل خاصية MOL و OFDMA ."
              ],
            },
          ],
          onu: [],
          ont: [],
          other: [],
        },
        columns: {
          areas: [
            {
              name: "الدور",
              zones: [
                {
                  number: "50",
                  poles: [
                    { number: 1, connected: 5, moved: 2, notes: "ملاحظات حول العمود 1" },
                    { number: 2, connected: 3, moved: 1, notes: "ملاحظات حول العمود 2" },
                  ]
                },
                {
                  number: "51",
                  poles: [
                    { number: 1, connected: 4, moved: 0, notes: "ملاحظات حول العمود 1" },
                  ]
                }
              ]
            },
            {
              name: "السلام",
              zones: [
                {
                  number: "100",
                  poles: [
                    { number: 1, connected: 6, moved: 1, notes: "ملاحظات حول العمود 1" },
                  ]
                }
              ]
            },
          ]
        },
        maintenanceNumbers: [
          { area: "منطقة (الدور والسلام والمجمع)", number: "07765991787" },
          { area: "منطقة حي العدل", number: "07719327451" },
          { area: "منطقة (الاولى والثالثة والبستان وربيع ودباش)", number: "07738494801" },
          { area: "منطقة ربيع ودباش", number: "07838755260" },
          { area: "منطقة الثانية", number: "07750633390" },
          { area: "منطقة الدولعي", number: "07859024132" },
          { area: "منطقة جكوك", number: "07858478756" },
          { area: "منطقة السيدية وحي العامل", number: "07838514192 او 07848775048" },
          { area: "رقم سوبرسيل حكومي", number: "07781050006" },
          { area: "رقم الشكاوي", number: "07759313075" }
        ],
        stickers: [
          { name: 'ستيكر وطني الدور وحي العدل', thumb: 'https://dc585.4shared.com/img/jzCZFS6Iku/s24/1993374b698/____?async&rand=0.08830512109580269' },
          { name: 'ستيكر السلام والزراعي والمجمع وسوبرسيل', thumb: 'https://dc730.4shared.com/img/2IMubdtljq/s24/1993374a6f8/____?async&rand=0.2608503140747772' },
          { name: 'ستيكر وطني (الاولى والثانية والثالثة والبستان وربيع ودباش)', thumb: 'https://dc730.4shared.com/img/NBIC_b16ku/s24/1993374b2b0/_________?async&rand=0.7303803786917789' },
          { name: 'ستيكر جكوك والدولعي', thumb: 'https://dc730.4shared.com/img/2N4HIxMtjq/s24/1993374aec8/___online?async&rand=0.550228095590632' }
        ]
      };

      // --- From contexts/AuthContext.tsx ---
      const AuthContext = createContext(undefined);

      const AuthProvider = ({ children }) => {
        const [userRole, setUserRole] = useState(null);

        useEffect(() => {
          const storedRole = localStorage.getItem('smartAgeUserRole');
          if (storedRole) {
            setUserRole(storedRole);
          }
        }, []);

        const login = (role, username, password) => {
          if (role === 'teamLeader') {
            localStorage.setItem('smartAgeUserRole', role);
            setUserRole(role);
            return true;
          }
          if (role === 'follower' && username === FOLLOWER_USERNAME && password === FOLLOWER_PASSWORD) {
            localStorage.setItem('smartAgeUserRole', role);
            setUserRole(role);
            return true;
          }
          if (role === 'admin' && username === ADMIN_USERNAME) {
            const adminPassword = localStorage.getItem("smartAgeAdminPassword") || DEFAULT_ADMIN_PASSWORD;
            if (password === adminPassword) {
              localStorage.setItem('smartAgeUserRole', role);
              setUserRole(role);
              return true;
            }
          }
          return false;
        };

        const logout = () => {
          localStorage.removeItem('smartAgeUserRole');
          setUserRole(null);
          window.location.reload();
        };

        const changePassword = (current, newPass) => {
          if (userRole !== 'admin') return false;
          const currentAdminPassword = localStorage.getItem("smartAgeAdminPassword") || DEFAULT_ADMIN_PASSWORD;
          if (current === currentAdminPassword) {
              localStorage.setItem("smartAgeAdminPassword", newPass);
              return true;
          }
          return false;
        };

        return (
          <AuthContext.Provider value={{ userRole, login, logout, changePassword }}>
            {children}
          </AuthContext.Provider>
        );
      };

      const useAuth = () => {
        const context = useContext(AuthContext);
        if (context === undefined) {
          throw new Error('useAuth must be used within an AuthProvider');
        }
        return context;
      };

      // --- From contexts/DataContext.tsx ---
      const debounce = (func, waitFor) => {
          let timeout = null;
          const debounced = (...args) => {
              if (timeout !== null) {
                  clearTimeout(timeout);
              }
              timeout = window.setTimeout(() => func(...args), waitFor);
          };
          return debounced;
      };

      // === إضافة لتصحيح الأخطاء ===
      console.log('=== Smart Age Debug ===');
      console.log('Window location:', window.location.href);
      console.log('Window origin:', window.location.origin);
      // === نهاية الإضافة ===

      // IMPORTANT: Replace these placeholder values with your actual Google Cloud credentials.
      // Note: Storing API keys and client IDs in frontend code is a security risk.
      // For production applications, these should be handled securely.
      const GOOGLE_API_KEY = 'AIzaSyB9w43IluUhR1g9wFyGvQ1G4ZHNHVHX6S0';
      const GOOGLE_CLIENT_ID = '672991789327-avu31r65pavg56s2nt4epk27bi71sg67.apps.googleusercontent.com';

      const SCOPES = 'https://www.googleapis.com/auth/drive.file';
      const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
      const FILE_NAME = 'smartAgeSiteData.json';

      const DataContext = createContext(undefined);

      const DataProvider = ({ children }) => {
          const { userRole } = useAuth();
          const [data, setData] = useState(INITIAL_DATA);
          
          const [gapiClient, setGapiClient] = useState(null);
          const [tokenClient, setTokenClient] = useState(null);
          const [isSignedInToGoogle, setIsSignedInToGoogle] = useState(false);
          const [driveFileId, setDriveFileId] = useState(null);
          const [syncStatus, setSyncStatus] = useState('UNINITIALIZED');
          const [lastSyncTime, setLastSyncTime] = useState(null);
          const isSyncReady = gapiClient !== null && tokenClient !== null;

          const saveDataToDrive = useCallback(async (fileId, newData) => {
              if (!fileId) return;
              setSyncStatus('SYNCING');
              try {
                  await window.gapi.client.request({
                      path: `/upload/drive/v3/files/${fileId}`,
                      method: 'PATCH',
                      params: { uploadType: 'media' },
                      body: JSON.stringify(newData, null, 2)
                  });
                  setSyncStatus('SYNCED');
                  setLastSyncTime(new Date());
              } catch (error) {
                  console.error("Error saving data to Drive:", error);
                  setSyncStatus('ERROR');
              }
          }, []);
          
          const debouncedSave = useCallback(debounce(saveDataToDrive, 2000), [saveDataToDrive]);

          const updateData = useCallback((newData) => {
              setData(newData);
              if (userRole === 'admin' && isSignedInToGoogle && driveFileId) {
                  debouncedSave(driveFileId, newData);
              }
          }, [userRole, isSignedInToGoogle, driveFileId, debouncedSave]);

          const updateField = useCallback((path, value) => {
              setData(currentData => {
                  const newData = JSON.parse(JSON.stringify(currentData));
                  let current = newData;
                  const keys = path.split('.');
                  for (let i = 0; i < keys.length - 1; i++) {
                      current = current[keys[i]];
                  }
                  current[keys[keys.length - 1]] = value;
                  
                  if (userRole === 'admin' && isSignedInToGoogle && driveFileId) {
                      debouncedSave(driveFileId, newData);
                  }
                  return newData;
              });
          }, [userRole, isSignedInToGoogle, driveFileId, debouncedSave]);
        
          useEffect(() => {
              const gapiScript = document.querySelector('script[src="https://apis.google.com/js/api.js"]');
              gapiScript.onload = () => {
                window.gapi.load('client', async () => {
                    await window.gapi.client.init({
                        apiKey: GOOGLE_API_KEY,
                        discoveryDocs: [DISCOVERY_DOC],
                    });
                    setGapiClient(window.gapi.client);
                });
              };
              
              const gisScript = document.querySelector('script[src="https://accounts.google.com/gsi/client"]');
              gisScript.onload = () => {
                const client = window.google.accounts.oauth2.initTokenClient({
                    client_id: GOOGLE_CLIENT_ID,
                    scope: SCOPES,
                    callback: '',
                });
                setTokenClient(client);
              };
          }, []);

          const findOrCreateFile = useCallback(async () => {
              try {
                  const response = await gapiClient.drive.files.list({
                      q: `name='${FILE_NAME}' and trashed=false`,
                      fields: 'files(id, name)',
                      spaces: 'drive'
                  });

                  if (response.result.files.length > 0) {
                      return response.result.files[0].id;
                  } else {
                      if (userRole !== 'admin') {
                           alert('Data file not found. Please ask an admin to sign in first to create it.');
                           return null;
                      }
                      const createResponse = await gapiClient.drive.files.create({
                          resource: { name: FILE_NAME, mimeType: 'application/json' },
                          fields: 'id'
                      });
                      const fileId = createResponse.result.id;
                      await saveDataToDrive(fileId, INITIAL_DATA);
                      return fileId;
                  }
              } catch (err) {
                  console.error("Error finding or creating file:", err);
                  setSyncStatus('ERROR');
                  return null;
              }
          }, [gapiClient, userRole, saveDataToDrive]);

          const loadDataFromDrive = useCallback(async (fileId) => {
              if (!fileId) return;
              setSyncStatus('SYNCING');
              try {
                  const response = await gapiClient.drive.files.get({ fileId, alt: 'media' });
                  const parsedData = JSON.parse(response.body);
                  setData(parsedData);
                  setSyncStatus('SYNCED');
                  setLastSyncTime(new Date());
              } catch (error) {
                  console.error("Error loading data:", error);
                  if (error.status === 401) handleGoogleSignOut();
                  setSyncStatus('ERROR');
              }
          }, [gapiClient]);
          
          const handleGoogleSignOut = useCallback(() => {
              const token = gapiClient?.client.getToken();
              if (token) {
                  window.google.accounts.oauth2.revoke(token.access_token, () => {});
                  gapiClient.client.setToken('');
              }
              setIsSignedInToGoogle(false);
              setDriveFileId(null);
              setSyncStatus('OFFLINE');
          }, [gapiClient]);
          
          const handleGoogleSignIn = useCallback(() => {
              if (!tokenClient) return;
              setSyncStatus('AUTHENTICATING');
              tokenClient.callback = async (resp) => {
                  if (resp.error) throw resp;
                  setIsSignedInToGoogle(true);
                  const fileId = await findOrCreateFile();
                  if (fileId) {
                      setDriveFileId(fileId);
                      await loadDataFromDrive(fileId);
                  } else {
                      handleGoogleSignOut();
                  }
              };
              
              if (!gapiClient.client.getToken()) {
                  tokenClient.requestAccessToken({ prompt: 'consent' });
              } else {
                  tokenClient.requestAccessToken({ prompt: '' });
              }
          }, [tokenClient, gapiClient, findOrCreateFile, loadDataFromDrive, handleGoogleSignOut]);
          
          useEffect(() => {
              let intervalId;
              if (isSignedInToGoogle && driveFileId) {
                  intervalId = window.setInterval(() => loadDataFromDrive(driveFileId), 30000);
              }
              return () => clearInterval(intervalId);
          }, [isSignedInToGoogle, driveFileId, loadDataFromDrive]);

        return (
          <DataContext.Provider value={{ data, updateData, updateField, syncStatus, lastSyncTime, isSignedInToGoogle, handleGoogleSignIn, handleGoogleSignOut, isSyncReady }}>
            {children}
          </DataContext.Provider>
        );
      };

      const useData = () => {
        const context = useContext(DataContext);
        if (context === undefined) {
          throw new Error('useData must be used within a DataProvider');
        }
        return context;
      };
      
      // --- From components/Modal.tsx ---
      const Modal = ({ title, children, onClose, footer }) => {
        return (
          <div
            className="fixed inset-0 bg-black/60 backdrop-blur-sm flex justify-center items-center z-[100]"
            onClick={onClose}
          >
            <div
              className="bg-white rounded-lg shadow-xl w-full max-w-md m-4 animate-fade-in-up"
              onClick={(e) => e.stopPropagation()}
            >
              <div className="flex justify-between items-center p-4 border-b">
                <h3 className="text-xl font-bold text-slate-800">{title}</h3>
                <button
                  onClick={onClose}
                  className="text-slate-400 hover:text-slate-800 text-2xl"
                >
                  &times;
                </button>
              </div>
              <div className="p-6">{children}</div>
              {footer && (
                <div className="flex justify-end gap-3 p-4 bg-slate-50 border-t rounded-b-lg">
                  {footer}
                </div>
              )}
            </div>
          </div>
        );
      };

      // --- From components/ChangePasswordModal.tsx ---
      const ChangePasswordModal = ({ setIsOpen }) => {
        const [currentPassword, setCurrentPassword] = useState('');
        const [newPassword, setNewPassword] = useState('');
        const [confirmPassword, setConfirmPassword] = useState('');
        const [error, setError] = useState('');
        const { changePassword } = useAuth();

        const handleSubmit = () => {
          if (newPassword !== confirmPassword) {
            setError("كلمة المرور الجديدة غير متطابقة.");
            return;
          }
          if (newPassword.length < 4) {
            setError("كلمة المرور الجديدة يجب أن تكون على الأقل 4 أحرف.");
            return;
          }

          if (changePassword(currentPassword, newPassword)) {
            alert("تم تغيير كلمة المرور بنجاح.");
            setIsOpen(false);
          } else {
            setError("كلمة المرور الحالية غير صحيحة.");
          }
        };

        return (
          <Modal title="تغيير كلمة المرور" onClose={() => setIsOpen(false)}>
            <div className="space-y-4 text-right">
              <div>
                <label className="block text-sm font-medium text-slate-700 mb-1">كلمة المرور الحالية</label>
                <input
                  type="password"
                  value={currentPassword}
                  onChange={(e) => setCurrentPassword(e.target.value)}
                  className="w-full p-2 border-2 border-slate-300 rounded-md"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-slate-700 mb-1">كلمة المرور الجديدة</label>
                <input
                  type="password"
                  value={newPassword}
                  onChange={(e) => setNewPassword(e.target.value)}
                  className="w-full p-2 border-2 border-slate-300 rounded-md"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-slate-700 mb-1">تأكيد كلمة المرور الجديدة</label>
                <input
                  type="password"
                  value={confirmPassword}
                  onChange={(e) => setConfirmPassword(e.target.value)}
                  className="w-full p-2 border-2 border-slate-300 rounded-md"
                />
              </div>
              {error && <p className="text-red-500 text-sm text-center">{error}</p>}
            </div>
            <div className="mt-6 flex justify-end gap-3">
              <button onClick={() => setIsOpen(false)} className="px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300">إلغاء</button>
              <button onClick={handleSubmit} className="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">حفظ</button>
            </div>
          </Modal>
        );
      };

      // --- From components/Login.tsx ---
      const Login = () => {
        const [view, setView] = useState('options');
        const [loginType, setLoginType] = useState(null);
        const [username, setUsername] = useState('');
        const [password, setPassword] = useState('');
        const [error, setError] = useState('');
        const { login } = useAuth();

        const handleShowForm = (type) => {
          setLoginType(type);
          setView('form');
          setError('');
          setUsername('');
          setPassword('');
        };

        const handleLogin = (e) => {
          e.preventDefault();
          if (!login(loginType, username, password)) {
            setError('اسم المستخدم أو كلمة المرور غير صحيحة.');
          }
        };

        return (
          <div id="login-overlay" className="fixed inset-0 bg-black/80 backdrop-blur-sm flex justify-center items-center z-50">
            <div className="login-container bg-white p-10 rounded-lg shadow-2xl w-full max-w-sm text-center animate-fade-in">
              <h2 className="text-2xl font-bold mb-6 text-slate-800">تسجيل الدخول</h2>
              
              {view === 'options' && (
                <div id="login-options" className="space-y-4">
                  <button
                    onClick={() => login('teamLeader')}
                    className="w-full py-3 px-4 bg-blue-500 text-white rounded-lg font-semibold text-lg hover:bg-blue-600 transition-colors"
                  >
                    الدخول كقائد فريق
                  </button>
                  <button
                    onClick={() => handleShowForm('follower')}
                    className="w-full py-3 px-4 bg-slate-100 text-slate-800 rounded-lg font-semibold text-lg border-2 border-slate-300 hover:bg-slate-200 transition-colors"
                  >
                    الدخول كمتابع
                  </button>
                  <button
                    onClick={() => handleShowForm('admin')}
                    className="w-full py-3 px-4 bg-red-500 text-white rounded-lg font-semibold text-lg hover:bg-red-600 transition-colors"
                  >
                    الدخول كمسؤول
                  </button>
                </div>
              )}

              {view === 'form' && (
                <form id="login-form" className="text-right" onSubmit={handleLogin}>
                  <div className="mb-4">
                    <label htmlFor="username" className="block mb-1 font-semibold text-slate-700">اسم المستخدم</label>
                    <input
                      type="text"
                      id="username"
                      value={username}
                      onChange={(e) => setUsername(e.target.value)}
                      className="w-full p-3 border-2 border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 transition"
                      required
                    />
                  </div>
                  <div className="mb-4">
                    <label htmlFor="password" className="block mb-1 font-semibold text-slate-700">كلمة المرور</label>
                    <input
                      type="password"
                      id="password"
                      value={password}
                      onChange={(e) => setPassword(e.target.value)}
                      className="w-full p-3 border-2 border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 transition"
                      required
                    />
                  </div>
                  {error && <p id="login-error" className="text-red-500 text-sm text-center mb-2 h-5">{error}</p>}
                  <button type="submit" className="w-full py-3 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                    دخول
                  </button>
                  <button
                    type="button"
                    onClick={() => setView('options')}
                    className="w-full mt-3 py-2 bg-slate-100 text-slate-800 rounded-lg font-semibold border-2 border-slate-300 hover:bg-slate-200 transition-colors"
                  >
                    رجوع
                  </button>
                </form>
              )}
            </div>
          </div>
        );
      };

      // --- From components/Layout.tsx ---
      const GoogleSyncButton = ({ isMobile = false }) => {
          const { 
              syncStatus, 
              lastSyncTime,
              isSignedInToGoogle,
              handleGoogleSignIn,
              handleGoogleSignOut,
              isSyncReady
          } = useData();

          if (!isSyncReady) {
              return (
                  <div className="flex items-center gap-2 px-3 py-1.5 text-sm font-semibold text-slate-400">
                      <i className="fas fa-spinner fa-spin"></i>
                      <span>تهيئة المزامنة...</span>
                  </div>
              );
          }
          
          if (!isSignedInToGoogle) {
              return (
                  <button onClick={handleGoogleSignIn} className={`flex items-center gap-2 text-sm font-semibold border-2 border-green-500 text-green-500 px-3 py-1.5 rounded-lg hover:bg-green-500 hover:text-white transition-colors ${isMobile ? 'w-full justify-center' : ''}`}>
                      <i className="fab fa-google-drive"></i>
                      <span>مزامنة مع Drive</span>
                  </button>
              );
          }
          
          let statusIcon, statusText, statusColor;
          switch (syncStatus) {
              case 'SYNCING':
                  statusIcon = 'fas fa-sync fa-spin';
                  statusText = 'جاري المزامنة...';
                  statusColor = 'text-yellow-400';
                  break;
              case 'SYNCED':
                  statusIcon = 'fas fa-check-circle';
                  statusText = `تمت المزامنة: ${lastSyncTime?.toLocaleTimeString()}`;
                  statusColor = 'text-green-400';
                  break;
              case 'ERROR':
                  statusIcon = 'fas fa-exclamation-triangle';
                  statusText = 'خطأ في المزامنة';
                  statusColor = 'text-red-400';
                  break;
              default:
                  statusIcon = 'fas fa-cloud';
                  statusText = 'متصل بـ Drive';
                  statusColor = 'text-blue-400';
          }

          return (
              <div className={`flex items-center gap-3 ${isMobile ? 'w-full' : ''}`}>
                  <div className={`flex items-center gap-2 ${statusColor} text-sm font-semibold`}>
                      <i className={statusIcon}></i>
                      <span>{statusText}</span>
                  </div>
                  <button onClick={handleGoogleSignOut} className="text-xs text-slate-400 hover:text-white">(خروج)</button>
              </div>
          );
      }

      const NavLink = ({ section, icon, label, activeSection, setActiveSection, hiddenFor = [], closeMobileNav }) => {
        const { userRole } = useAuth();
        if (userRole && hiddenFor.includes(userRole)) {
          return null;
        }
        const isActive = activeSection === section;
        
        const handleClick = (e) => {
          e.preventDefault();
          setActiveSection(section);
          if (closeMobileNav) {
            closeMobileNav();
          }
        };

        return (
          <li>
            <a
              href="#"
              onClick={handleClick}
              className={`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors duration-300 whitespace-nowrap ${
                isActive ? 'bg-white/10' : 'hover:bg-white/10'
              }`}
            >
              <i className={`fas ${icon}`}></i>
              <span>{label}</span>
            </a>
          </li>
        );
      };

      const Layout = ({children, activeSection, setActiveSection}) => {
        const { userRole, logout } = useAuth();
        const [isMobileNavOpen, setMobileNavOpen] = useState(false);
        const [isPasswordModalOpen, setPasswordModalOpen] = useState(false);

        const roleText = {
          follower: 'المتابع',
          teamLeader: 'قائد فريق',
          admin: 'المسؤول',
        };

        const navLinks = [
          { section: Section.Home, icon: 'fa-home', label: 'الرئيسية' },
          { section: Section.Maps, icon: 'fa-map', label: 'الخرائط' },
          { section: Section.Offers, icon: 'fa-percent', label: 'العروض', hiddenFor: ['teamLeader'] },
          { section: Section.Vlans, icon: 'fa-network-wired', label: 'الفيلانات' },
          { section: Section.Materials, icon: 'fa-microchip', label: 'المواد' },
          { section: Section.Maintenance, icon: 'fa-tools', label: 'الصيانة' },
          { section: Section.Columns, icon: 'fa-columns', label: 'الأعمدة' },
          { section: Section.Contact, icon: 'fa-phone', label: 'اتصل بنا' },
        ];

        return (
          <>
            <header className="bg-gradient-to-r from-slate-800 to-slate-900 text-white shadow-lg sticky top-0 z-40">
              <div className="container mx-auto px-4 flex justify-between items-center h-16">
                <div className="flex items-center gap-3">
                  <img src="https://dc585.4shared.com/img/O-lyn4tEku/s24/19933795a18/_online?async&rand=0.6523859132132545" alt="Logo" className="h-10" />
                  <span className="text-xl font-bold whitespace-nowrap">شركة العصر الذكي</span>
                </div>
                
                <nav className="hidden xl:flex">
                  <ul className="flex items-center gap-2">
                    {navLinks.map(link => <NavLink key={link.section} {...link} activeSection={activeSection} setActiveSection={setActiveSection} />)}
                  </ul>
                </nav>

                <div className="flex items-center gap-4">
                  <div className="hidden xl:flex items-center gap-4">
                    <GoogleSyncButton />
                    <div className="flex items-center gap-2 bg-white/10 px-3 py-2 rounded-lg">
                      <i className="fas fa-user-circle text-blue-400 text-xl"></i>
                      <span className="font-semibold text-sm">{userRole ? roleText[userRole] : ''}</span>
                    </div>
                    {userRole === 'admin' && (
                      <button onClick={() => setPasswordModalOpen(true)} className="flex items-center gap-2 text-sm font-semibold border-2 border-yellow-500 text-yellow-500 px-3 py-1.5 rounded-lg hover:bg-yellow-500 hover:text-slate-900 transition-colors">
                        <i className="fas fa-key"></i>
                      </button>
                    )}
                    <button onClick={logout} className="flex items-center gap-2 text-sm font-semibold border-2 border-red-500 text-red-500 px-3 py-1.5 rounded-lg hover:bg-red-500 hover:text-white transition-colors">
                      <i className="fas fa-sign-out-alt"></i>
                    </button>
                  </div>
                  <button className="xl:hidden text-2xl" onClick={() => setMobileNavOpen(true)}>
                    <i className="fas fa-bars"></i>
                  </button>
                </div>
              </div>
            </header>

            {/* Mobile Nav */}
            <div className={`fixed top-0 right-0 h-full w-72 bg-slate-800 z-50 transform transition-transform duration-300 ease-in-out ${isMobileNavOpen ? 'translate-x-0' : 'translate-x-full'}`}>
              <div className="p-4 flex justify-between items-center border-b border-white/10">
                <span className="text-lg font-bold text-white">القائمة</span>
                <button onClick={() => setMobileNavOpen(false)} className="text-2xl text-white">
                  <i className="fas fa-times"></i>
                </button>
              </div>
              <nav className="p-4">
                <ul className="flex flex-col gap-2">
                   {navLinks.map(link => <NavLink key={link.section} {...link} activeSection={activeSection} setActiveSection={setActiveSection} closeMobileNav={() => setMobileNavOpen(false)} />)}
                </ul>
              </nav>
              <div className="absolute bottom-0 left-0 right-0 p-4 border-t border-white/10 flex flex-col gap-3">
                 <GoogleSyncButton isMobile={true} />
                 <div className="flex items-center gap-2 bg-white/10 px-3 py-2 rounded-lg text-sm text-white">
                      <i className="fas fa-user-circle text-blue-400 text-xl"></i>
                      <span className="font-semibold">{userRole ? roleText[userRole] : ''}</span>
                  </div>
                    {userRole === 'admin' && (
                      <button onClick={() => {setPasswordModalOpen(true); setMobileNavOpen(false)}} className="w-full flex items-center justify-center gap-2 text-sm font-semibold border-2 border-yellow-500 text-yellow-500 px-3 py-1.5 rounded-lg hover:bg-yellow-500 hover:text-slate-900 transition-colors">
                        <i className="fas fa-key"></i>
                        <span>تغيير كلمة المرور</span>
                      </button>
                    )}
                    <button onClick={logout} className="w-full flex items-center justify-center gap-2 text-sm font-semibold border-2 border-red-500 text-red-500 px-3 py-1.5 rounded-lg hover:bg-red-500 hover:text-white transition-colors">
                      <i className="fas fa-sign-out-alt"></i>
                      <span>تسجيل الخروج</span>
                    </button>
              </div>
            </div>
            {isMobileNavOpen && <div className="fixed inset-0 bg-black/60 z-40 xl:hidden" onClick={() => setMobileNavOpen(false)}></div>}

            <main>
              {children}
            </main>
            
            <footer className="bg-slate-800 text-white mt-16">
              <div className="container mx-auto px-4 py-8">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8 text-center md:text-right">
                      <div>
                          <h3 className="text-xl font-bold mb-4 border-b-2 border-blue-500 pb-2 inline-block">عن الشركة</h3>
                          <p className="text-slate-300 text-sm">شركة إنترنت رائدة في تقديم خدمات الإنترنت عالية الجودة والحلول التقنية المتطورة لعملائنا في جميع المناطق.</p>
                      </div>
                      <div>
                          <h3 className="text-xl font-bold mb-4 border-b-2 border-blue-500 pb-2 inline-block">روابط سريعة</h3>
                          <ul className="text-slate-300 space-y-2 text-sm">
                             {navLinks.map(link => (
                                <li key={`footer-${link.section}`} className={(link.hiddenFor && userRole && link.hiddenFor.includes(userRole)) ? 'hidden' : ''}>
                                   <a href="#" onClick={(e) => { e.preventDefault(); setActiveSection(link.section); window.scrollTo(0,0); }} className="hover:text-blue-400 transition-colors">
                                      <i className={`fas ${link.icon} ml-2`}></i>{link.label}
                                   </a>
                                </li>
                             ))}
                          </ul>
                      </div>
                      <div>
                          <h3 className="text-xl font-bold mb-4 border-b-2 border-blue-500 pb-2 inline-block">معلومات الاتصال</h3>
                          <div className="text-slate-300 space-y-2 text-sm">
                              <p><i className="fas fa-map-marker-alt ml-2 text-blue-400"></i>العنوان: الحرية, الدور, قرب مصور عيسى</p>
                              <p><i className="fas fa-phone ml-2 text-blue-400"></i>الهاتف: 07838102085</p>
                              <p><i className="fas fa-envelope ml-2 text-blue-400"></i>البريد: alitahasmartnet@gmail.com</p>
                          </div>
                      </div>
                  </div>
                  <div className="text-center pt-4 border-t border-white/10 text-xs text-slate-400">
                      <p>شركة العصر الذكي &copy; {new Date().getFullYear()}</p>
                  </div>
              </div>
            </footer>

            {isPasswordModalOpen && <ChangePasswordModal setIsOpen={setPasswordModalOpen} />}
          </>
        );
      };
      
      // --- From sections/Home.tsx ---
      const ServiceCard = ({ imgSrc, title, description, section, setActiveSection }) => (
        <div className="bg-white rounded-lg shadow-lg overflow-hidden transform hover:-translate-y-1 transition-transform duration-300">
          <div className="h-44 overflow-hidden">
            <img src={imgSrc} alt={title} className="w-full h-full object-cover" />
          </div>
          <div className="p-5">
            <h3 className="text-xl font-bold text-slate-800 mb-2">{title}</h3>
            <p className="text-slate-600 mb-4 text-sm">{description}</p>
            <button onClick={() => setActiveSection(section)} className="font-semibold text-blue-500 hover:text-blue-600">
              استعرض الآن <i className="fas fa-arrow-left mr-2"></i>
            </button>
          </div>
        </div>
      );

      const Home = ({ setActiveSection }) => {
        return (
          <div className="animate-fade-in">
            <section className="hero bg-cover bg-center h-[65vh] flex items-center justify-center text-white" style={{backgroundImage: "linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.7)), url('https://dc585.4shared.com/img/B9PkdLWRfa/s24/1993358aae8/_online?async&rand=0.5108986475801636')"}}>
              <div className="text-center max-w-3xl px-4">
                <h1 className="text-4xl md:text-5xl font-extrabold mb-4 text-shadow-lg">خدمات إنترنت فائقة السرعة</h1>
                <p className="text-lg md:text-xl mb-6 text-shadow">نقدم لكم أحدث حلول الإنترنت والاتصالات مع أفضل الخدمات التقنية والدعم الفني المتميز.</p>
              </div>
            </section>

            <div className="container mx-auto px-4 py-16">
              <h2 className="text-3xl font-bold text-center mb-12 text-slate-800 relative after:content-[''] after:absolute after:w-20 after:h-1 after:bg-blue-500 after:left-1/2 after:-translate-x-1/2 after:bottom-[-10px] after:rounded-full">خدماتنا</h2>
              <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <ServiceCard
                  imgSrc="https://dc585.4shared.com/img/TpHWOgkfge/s24/199335dee90/_online?async&rand=0.9971719481601765"
                  title="خرائط المناطق"
                  description="استكشف خرائط الشبكة التفصيلية لجميع المناطق."
                  section={Section.Maps}
                  setActiveSection={setActiveSection}
                />
                <ServiceCard
                  imgSrc="https://dc525.4shared.com/img/exrQ5Iyjfa/s24/1993358a318/_online?async&rand=0.6069926996845987"
                  title="العروض والخصومات"
                  description="اكتشف أحدث العروض والخصومات على باقات الإنترنت."
                  section={Section.Offers}
                  setActiveSection={setActiveSection}
                />
                <ServiceCard
                  imgSrc="https://dc585.4shared.com/img/1jFK99w6ge/s24/19933619fe0/__online?async&rand=0.9196284863098757"
                  title="الأجهزة والمواد"
                  description="تصفح أحدث أجهزة الإنترنت والمواد التقنية."
                  section={Section.Materials}
                  setActiveSection={setActiveSection}
                />
              </div>
            </div>
          </div>
        );
      };

      // --- From sections/Maps.tsx ---
      const Maps = () => {
          const { data, updateData } = useData();
          const { userRole } = useAuth();
          const [searchTerm, setSearchTerm] = useState('');
          const [showForm, setShowForm] = useState(false);
          const [formData, setFormData] = useState({ name: '', link: '' });
          const [editingIndex, setEditingIndex] = useState(null);

          const filteredMaps = data.maps.filter(map =>
              map.name.toLowerCase().includes(searchTerm.toLowerCase())
          );
          
          const handleAddNewClick = () => {
              setEditingIndex(null);
              setFormData({ name: '', link: '' });
              setShowForm(true);
          };

          const handleEditClick = (index) => {
              setEditingIndex(index);
              setFormData(data.maps[index]);
              setShowForm(true);
          };

          const handleSaveMap = () => {
              if (formData.name && formData.link) {
                  const newMaps = [...data.maps];
                  if (editingIndex !== null) {
                      newMaps[editingIndex] = formData;
                  } else {
                      newMaps.push(formData);
                  }
                  updateData({ ...data, maps: newMaps });
                  setShowForm(false);
              }
          };

          const handleDeleteMap = (index) => {
              if (window.confirm(`هل أنت متأكد من حذف خريطة "${data.maps[index].name}"؟`)) {
                  const newMaps = [...data.maps];
                  newMaps.splice(index, 1);
                  updateData({ ...data, maps: newMaps });
              }
          };

          return (
              <section className="container mx-auto px-4 py-12 animate-fade-in">
                  <h2 className="text-3xl font-bold text-center mb-12 text-slate-800 relative after:content-[''] after:absolute after:w-20 after:h-1 after:bg-blue-500 after:left-1/2 after:-translate-x-1/2 after:bottom-[-10px] after:rounded-full">خرائط المناطق</h2>
                  
                  <div className="max-w-xl mx-auto mb-8 relative">
                      <input
                          type="text"
                          placeholder="ابحث عن خريطة المنطقة..."
                          value={searchTerm}
                          onChange={(e) => setSearchTerm(e.target.value)}
                          className="w-full p-3 pl-10 border-2 border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 transition"
                      />
                      <i className="fas fa-search absolute right-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                  </div>
                  
                  {userRole === 'admin' && (
                      <div className="max-w-xl mx-auto my-6 p-4 bg-slate-50 border rounded-lg">
                          <button onClick={showForm ? () => setShowForm(false) : handleAddNewClick} className="text-blue-600 font-semibold flex items-center gap-2">
                              <i className={`fas ${showForm ? 'fa-times' : 'fa-plus'}`}></i>
                              {showForm ? 'إلغاء' : 'إضافة خريطة جديدة'}
                          </button>
                          {showForm && (
                              <div className="mt-4 space-y-3 text-right">
                                   <h3 className="text-lg font-semibold">{editingIndex !== null ? 'تعديل الخريطة' : 'إضافة خريطة جديدة'}</h3>
                                  <div>
                                      <label className="block text-sm font-medium text-slate-700">اسم الخريطة</label>
                                      <input type="text" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} className="mt-1 w-full p-2 border rounded-md" />
                                  </div>
                                  <div>
                                      <label className="block text-sm font-medium text-slate-700">رابط الخريطة</label>
                                      <input type="text" value={formData.link} onChange={e => setFormData({...formData, link: e.target.value})} className="mt-1 w-full p-2 border rounded-md" />
                                  </div>
                                  <button onClick={handleSaveMap} className="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">حفظ الخريطة</button>
                              </div>
                          )}
                      </div>
                  )}

                  <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-6 mt-8">
                      {filteredMaps.map((map, index) => {
                          const originalIndex = data.maps.findIndex(m => m.name === map.name && m.link === map.link);
                          return (
                          <div key={originalIndex} className="bg-white rounded-lg shadow-md overflow-hidden text-center transform hover:-translate-y-1 transition-transform duration-300 relative group">
                              <a
                                  href={map.link}
                                  target="_blank"
                                  rel="noopener noreferrer"
                                  className="block"
                              >
                                  <div className="bg-slate-800 text-white font-bold p-2">{index + 1}</div>
                                  <div className="p-4 font-semibold text-slate-700">{map.name}</div>
                              </a>
                              {userRole === 'admin' && (
                                  <div className="absolute top-1 right-1 z-10 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                      <button 
                                          onClick={() => handleEditClick(originalIndex)}
                                          className="w-6 h-6 bg-yellow-400 text-white rounded-full flex items-center justify-center"
                                          title="تعديل الخريطة"
                                      >
                                          <i className="fas fa-pen text-xs"></i>
                                      </button>
                                      <button 
                                          onClick={() => handleDeleteMap(originalIndex)} 
                                          className="w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center"
                                          title="حذف الخريطة"
                                      >
                                          <i className="fas fa-trash-alt text-xs"></i>
                                      </button>
                                  </div>
                              )}
                          </div>
                      )})}
                  </div>
              </section>
          );
      };
      
      // --- From sections/Offers.tsx ---
      const EditableCell = ({ value, onSave, isAdmin }) => {
          const handleBlur = (e) => {
              onSave(e.currentTarget.textContent || '');
          };

          return (
              <td
                  contentEditable={isAdmin}
                  onBlur={handleBlur}
                  suppressContentEditableWarning={true}
                  className="p-3 border-b border-slate-200"
              >
                  {value}
              </td>
          );
      };

      const Offers = () => {
          const { data, updateData } = useData();
          const { userRole } = useAuth();
          const [searchTerm, setSearchTerm] = useState('');
          const [selectedArea, setSelectedArea] = useState(null);

          const isAdmin = userRole === 'admin';

          const handleSearch = () => {
              if (data.offers[searchTerm]) {
                  setSelectedArea(searchTerm);
              } else {
                  setSelectedArea(null);
                  if(searchTerm) alert(`لا توجد عروض للمنطقة: ${searchTerm}`);
              }
          };
          
          const handleUpdate = (area, offerIndex, field, value, rowIndex, cellIndex) => {
              const newData = JSON.parse(JSON.stringify(data));
              if (field === 'table' && rowIndex !== undefined && cellIndex !== undefined) {
                  newData.offers[area][offerIndex].table[rowIndex][cellIndex] = value;
              } else if (field !== 'table') {
                  newData.offers[area][offerIndex][field] = value;
              }
              updateData(newData);
          };

          const handleAddRow = (area, offerIndex) => {
              const newData = JSON.parse(JSON.stringify(data));
              newData.offers[area][offerIndex].table.push(["مدة جديدة", "0", "0", "0", "0"]);
              updateData(newData);
          };

          const handleDeleteRow = (area, offerIndex, rowIndex) => {
              if (confirm('هل أنت متأكد من حذف هذا الصف؟')) {
                  const newData = JSON.parse(JSON.stringify(data));
                  newData.offers[area][offerIndex].table.splice(rowIndex, 1);
                  updateData(newData);
              }
          };

          const handleDeleteOffer = (area, offerIndex) => {
               if (confirm('هل أنت متأكد من حذف هذا العرض بالكامل؟')) {
                  const newData = JSON.parse(JSON.stringify(data));
                  newData.offers[area].splice(offerIndex, 1);
                  if(newData.offers[area].length === 0){
                      delete newData.offers[area];
                      setSelectedArea(null);
                  }
                  updateData(newData);
              }
          };
          
          const handleAddNewAreaOffer = () => {
              const newArea = prompt("أدخل اسم أو رقم المنطقة الجديدة:");
              if (newArea && !data.offers[newArea]) {
                  const newData = JSON.parse(JSON.stringify(data));
                  newData.offers[newArea] = [{
                      title: `عرض جديد للمنطقة ${newArea}`,
                      table: [["شهر", "15000", "20000", "30000", "75000"]],
                      note: "ملاحظات العرض الجديد."
                  }];
                  updateData(newData);
                  setSearchTerm(newArea);
                  setSelectedArea(newArea);
              } else if (newArea) {
                  alert("هذه المنطقة موجودة بالفعل.");
              }
          };

          return (
              <section className="container mx-auto px-4 py-12 animate-fade-in">
                  <h2 className="text-3xl font-bold text-center mb-12 text-slate-800 relative after:content-[''] after:absolute after:w-20 after:h-1 after:bg-blue-500 after:left-1/2 after:-translate-x-1/2 after:bottom-[-10px] after:rounded-full">العروض المتاحة</h2>
                  
                  <div className="max-w-xl mx-auto p-6 bg-white rounded-lg shadow-md">
                      <label htmlFor="areaNumber" className="block text-lg font-semibold text-slate-700 mb-2">أدخل رقم المنطقة أو اسمها:</label>
                      <input
                          type="text"
                          id="areaNumber"
                          value={searchTerm}
                          onChange={(e) => setSearchTerm(e.target.value)}
                          onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                          className="w-full p-3 border-2 border-slate-300 rounded-lg focus:border-blue-500"
                          placeholder="مثال: 44, 115, مجمع..."
                      />
                      <div className="mt-4 flex flex-col gap-2">
                          <button onClick={handleSearch} className="w-full py-3 bg-blue-500 text-white font-bold rounded-lg hover:bg-blue-600 transition">
                              عرض العروض <i className="fas fa-arrow-left mr-2"></i>
                          </button>
                          {isAdmin && (
                              <button onClick={handleAddNewAreaOffer} className="w-full py-3 bg-green-500 text-white font-bold rounded-lg hover:bg-green-600 transition">
                                  إضافة عرض لمنطقة جديدة
                              </button>
                          )}
                      </div>
                  </div>

                  {selectedArea && (
                      <div className="mt-12 space-y-8">
                          {data.offers[selectedArea].map((offer, offerIndex) => (
                              <div key={offerIndex} className="bg-white rounded-lg shadow-lg p-6 relative group">
                                  {isAdmin && (
                                      <button onClick={() => handleDeleteOffer(selectedArea, offerIndex)} className="absolute top-3 left-3 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity" title="حذف العرض بالكامل">
                                           <i className="fas fa-trash-alt text-sm"></i>
                                      </button>
                                  )}
                                  <h3
                                      contentEditable={isAdmin}
                                      onBlur={(e) => handleUpdate(selectedArea, offerIndex, 'title', e.currentTarget.textContent || '')}
                                      suppressContentEditableWarning={true}
                                      className="text-2xl font-bold text-center mb-6 text-slate-800 p-1 rounded-md"
                                  >
                                      {offer.title}
                                      {isAdmin && <i className="fas fa-pen text-xs text-slate-400 mr-2 opacity-0 group-hover:opacity-100"></i>}
                                  </h3>
                                  <div className="overflow-x-auto">
                                      <table className="w-full text-center">
                                          <thead className="bg-blue-500 text-white">
                                              <tr>
                                                  <th className="p-3">المدة</th>
                                                  <th className="p-3">فئة اولى</th>
                                                  <th className="p-3">فئة ثانية</th>
                                                  <th className="p-3">فئة ثالثة</th>
                                                  <th className="p-3">فئة رابعة</th>
                                                  {isAdmin && <th className="p-3 w-12"></th>}
                                              </tr>
                                          </thead>
                                          <tbody>
                                              {offer.table.map((row, rowIndex) => (
                                                  <tr key={rowIndex} className="odd:bg-slate-50">
                                                      {row.map((cell, cellIndex) => (
                                                          <EditableCell
                                                              key={cellIndex}
                                                              value={cell}
                                                              isAdmin={isAdmin}
                                                              onSave={(newValue) => handleUpdate(selectedArea, offerIndex, 'table', newValue, rowIndex, cellIndex)}
                                                          />
                                                      ))}
                                                      {isAdmin && (
                                                          <td className="p-3 border-b border-slate-200">
                                                              <button onClick={() => handleDeleteRow(selectedArea, offerIndex, rowIndex)} className="text-red-500 hover:text-red-700">
                                                                  <i className="fas fa-trash-alt"></i>
                                                              </button>
                                                          </td>
                                                      )}
                                                  </tr>
                                              ))}
                                          </tbody>
                                      </table>
                                  </div>
                                  {isAdmin && (
                                      <div className="text-center mt-4">
                                          <button onClick={() => handleAddRow(selectedArea, offerIndex)} className="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600">
                                              <i className="fas fa-plus mr-2"></i> إضافة مدة
                                          </button>
                                      </div>
                                  )}
                                  <div
                                      contentEditable={isAdmin}
                                      onBlur={(e) => handleUpdate(selectedArea, offerIndex, 'note', e.currentTarget.textContent || '')}
                                      suppressContentEditableWarning={true}
                                      className="mt-6 p-4 bg-slate-100 rounded-md text-center text-slate-700 font-semibold"
                                  >
                                      {offer.note}
                                      {isAdmin && <i className="fas fa-pen text-xs text-slate-400 mr-2 opacity-0 group-hover:opacity-100"></i>}
                                  </div>
                              </div>
                          ))}
                      </div>
                  )}
              </section>
          );
      };

      // --- From sections/Vlans.tsx ---
      const Vlans = () => {
          const { data, updateData } = useData();
          const { userRole } = useAuth();
          const isAdmin = userRole === 'admin';
          const [searchTerm, setSearchTerm] = useState('');
          const [searchResult, setSearchResult] = useState(null);

          const handleSearch = () => {
              const term = searchTerm.trim();
              if (!term) return;

              const vlan = data.vlans[term];
              if (vlan) {
                  setSearchResult({ area: term, vlan });
              } else {
                  setSearchResult(null);
                  alert(`لا يوجد فيلان للمنطقة: ${term}`);
              }
          };

          const handleAddVlan = () => {
              const area = prompt("أدخل اسم المنطقة الجديدة:");
              if (area && !data.vlans[area]) {
                  const number = prompt(`أدخل رقم الفيلان للمنطقة ${area}:`);
                  if (number) {
                      const newVlans = { ...data.vlans, [area]: number };
                      updateData({ ...data, vlans: newVlans });
                      alert(`تمت إضافة فيلان منطقة "${area}" بنجاح.`);
                  }
              } else if (area) {
                  alert("هذه المنطقة موجودة بالفعل.");
              }
          };
          
          const handleEditVlan = (area) => {
              const newNumber = prompt(`أدخل رقم الفيلان الجديد للمنطقة ${area}:`, data.vlans[area]);
              if (newNumber) {
                  const newVlans = { ...data.vlans, [area]: newNumber };
                  updateData({ ...data, vlans: newVlans });
                  if(searchResult && searchResult.area === area) {
                      setSearchResult({ area, vlan: newNumber });
                  }
                  alert(`تم تعديل فيلان منطقة "${area}" بنجاح.`);
              }
          };

          return (
              <section className="container mx-auto px-4 py-12 animate-fade-in">
                  <h2 className="text-3xl font-bold text-center mb-12 text-slate-800 relative after:content-[''] after:absolute after:w-20 after:h-1 after:bg-blue-500 after:left-1/2 after:-translate-x-1/2 after:bottom-[-10px] after:rounded-full">فيلانات المناطق</h2>
                  
                  <div className="max-w-lg mx-auto p-6 bg-white rounded-lg shadow-md text-center">
                       <h3 className="text-2xl font-bold text-slate-800 mb-4">ابحث عن فيلان منطقة</h3>
                       <div className="form-group mb-4 text-right">
                          <label htmlFor="vlanInput" className="block text-lg font-semibold text-slate-700 mb-2">أدخل رقم المنطقة أو اسمها:</label>
                          <input
                              type="text"
                              id="vlanInput"
                              value={searchTerm}
                              onChange={(e) => setSearchTerm(e.target.value)}
                              onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                              className="w-full p-3 border-2 border-slate-300 rounded-lg focus:border-blue-500"
                              placeholder="مثال: 151, مجمع..."
                          />
                      </div>
                      <div className="flex flex-col gap-3">
                          <button onClick={handleSearch} className="w-full py-3 bg-blue-500 text-white font-bold rounded-lg hover:bg-blue-600 transition">
                             عرض الفيلان <i className="fas fa-arrow-left mr-2"></i>
                          </button>
                          {isAdmin && (
                               <button onClick={handleAddVlan} className="w-full py-2 bg-green-500 text-white font-bold rounded-lg hover:bg-green-600 transition">
                                  <i className="fas fa-plus mr-2"></i> إضافة فيلان جديد
                              </button>
                          )}
                      </div>
                      {searchResult && (
                          <div className="mt-8 p-6 bg-slate-50 border rounded-lg animate-fade-in">
                              <div className="flex justify-center items-center gap-4">
                                  <div>
                                      <p className="text-lg">المنطقة: <span className="font-bold">{searchResult.area}</span></p>
                                      <p className="text-xl">الفيلان: <span className="font-extrabold text-blue-600 text-3xl">{searchResult.vlan}</span></p>
                                  </div>
                                  {isAdmin && (
                                      <button onClick={() => handleEditVlan(searchResult.area)} className="px-3 py-1 bg-yellow-400 text-white text-sm rounded-md hover:bg-yellow-500" title="تعديل">
                                          <i className="fas fa-pen"></i>
                                      </button>
                                  )}
                              </div>
                          </div>
                      )}
                  </div>
              </section>
          );
      };
      
      // --- From sections/Materials.tsx ---
      const categories = [
          { id: 'routers', name: 'الراوترات' },
          { id: 'onu', name: 'ONU' },
          { id: 'ont', name: 'ONT' },
          { id: 'other', name: 'المواد الأخرى' },
      ];

      const MaterialForm = ({ initialMaterial, category, onSave, onClose }) => {
          const [material, setMaterial] = useState(
              initialMaterial || { name: '', price: '', image: '', specs: [] }
          );

          const handleChange = (field, value) => {
              if (field === 'specs') {
                  setMaterial({ ...material, specs: value.split('\n') });
              } else {
                  setMaterial({ ...material, [field]: value });
              }
          };

          const handleSave = () => {
              onSave(material);
              onClose();
          };

          return (
              <Modal title={initialMaterial ? 'تعديل المادة' : 'إضافة مادة جديدة'} onClose={onClose}>
                  <div className="space-y-4 text-right">
                      <div>
                          <label className="block text-sm font-medium text-slate-700">اسم المادة</label>
                          <input type="text" value={material.name} onChange={(e) => handleChange('name', e.target.value)} className="mt-1 w-full p-2 border rounded-md" />
                      </div>
                      <div>
                          <label className="block text-sm font-medium text-slate-700">السعر</label>
                          <input type="text" value={material.price} onChange={(e) => handleChange('price', e.target.value)} className="mt-1 w-full p-2 border rounded-md" />
                      </div>
                      <div>
                          <label className="block text-sm font-medium text-slate-700">رابط الصورة</label>
                          <input type="text" value={material.image} onChange={(e) => handleChange('image', e.target.value)} className="mt-1 w-full p-2 border rounded-md" />
                      </div>
                      <div>
                          <label className="block text-sm font-medium text-slate-700">المواصفات (كل مواصفة في سطر)</label>
                          <textarea value={material.specs.join('\n')} onChange={(e) => handleChange('specs', e.target.value)} className="mt-1 w-full p-2 border rounded-md" rows={4}></textarea>
                      </div>
                  </div>
                   <div className="mt-6 flex justify-end gap-3">
                      <button onClick={onClose} className="px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300">إلغاء</button>
                      <button onClick={handleSave} className="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">حفظ</button>
                  </div>
              </Modal>
          );
      };

      const Materials = () => {
          const { data, updateData } = useData();
          const { userRole } = useAuth();
          const isAdmin = userRole === 'admin';
          const [activeCategory, setActiveCategory] = useState('routers');
          const [isModalOpen, setModalOpen] = useState(false);
          const [editingMaterial, setEditingMaterial] = useState(null);

          const handleOpenModal = (material = null, index = -1) => {
              setEditingMaterial(material ? { material, index } : null);
              setModalOpen(true);
          };

          const handleSaveMaterial = (material) => {
              const newData = JSON.parse(JSON.stringify(data));
              if (editingMaterial) {
                  newData.materials[activeCategory][editingMaterial.index] = material;
              } else {
                  if (!newData.materials[activeCategory]) {
                      newData.materials[activeCategory] = [];
                  }
                  newData.materials[activeCategory].push(material);
              }
              updateData(newData);
          };

          const handleDeleteMaterial = (index) => {
              if (window.confirm('هل أنت متأكد من حذف هذه المادة؟')) {
                  const newData = JSON.parse(JSON.stringify(data));
                  newData.materials[activeCategory].splice(index, 1);
                  updateData(newData);
              }
          };

          return (
              <section className="container mx-auto px-4 py-12 animate-fade-in">
                  <h2 className="text-3xl font-bold text-center mb-12 text-slate-800 relative after:content-[''] after:absolute after:w-20 after:h-1 after:bg-blue-500 after:left-1/2 after:-translate-x-1/2 after:bottom-[-10px] after:rounded-full">الأجهزة والمواد</h2>
                  
                  <div className="flex justify-center flex-wrap gap-4 mb-8">
                      {categories.map(cat => (
                          <button
                              key={cat.id}
                              onClick={() => setActiveCategory(cat.id)}
                              className={`px-6 py-2 rounded-lg font-semibold transition-colors ${
                                  activeCategory === cat.id
                                      ? 'bg-blue-500 text-white'
                                      : 'bg-white text-blue-500 border-2 border-blue-500 hover:bg-blue-50'
                              }`}
                          >
                              {cat.name}
                          </button>
                      ))}
                  </div>

                  {isAdmin && (
                      <div className="text-center mb-8">
                          <button onClick={() => handleOpenModal()} className="px-6 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 flex items-center gap-2 mx-auto">
                              <i className="fas fa-plus"></i>
                              <span>إضافة مادة جديدة</span>
                          </button>
                      </div>
                  )}

                  <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-8">
                      {(data.materials[activeCategory] || []).map((item, index) => (
                          <div key={index} className="bg-white rounded-lg shadow-lg overflow-hidden flex flex-col group relative">
                               {isAdmin && (
                                  <div className="absolute top-2 right-2 z-10 flex gap-2">
                                      <button onClick={() => handleOpenModal(item, index)} className="w-8 h-8 bg-yellow-400 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity" title="تعديل"><i className="fas fa-pen text-sm"></i></button>
                                      <button onClick={() => handleDeleteMaterial(index)} className="w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity" title="حذف"><i className="fas fa-trash-alt text-sm"></i></button>
                                  </div>
                              )}
                              <div className="h-48 overflow-hidden">
                                  <img src={item.image} alt={item.name} className="w-full h-full object-cover" />
                              </div>
                              <div className="p-5 flex flex-col flex-grow">
                                  <h3 className="text-lg font-bold text-slate-800">{item.name}</h3>
                                  <p className="text-2xl font-extrabold text-red-500 my-2">{item.price}</p>
                                  <ul className="text-slate-600 text-sm space-y-1 list-disc list-inside mt-auto">
                                      {item.specs.map((spec, i) => <li key={i}>{spec}</li>)}
                                  </ul>
                              </div>
                          </div>
                      ))}
                      {(!data.materials[activeCategory] || data.materials[activeCategory].length === 0) && (
                          <p className="col-span-full text-center text-slate-500">لا توجد مواد في هذه الفئة.</p>
                      )}
                  </div>
                  {isModalOpen && <MaterialForm initialMaterial={editingMaterial?.material || null} category={activeCategory} onSave={handleSaveMaterial} onClose={() => setModalOpen(false)} />}
              </section>
          );
      };
      
      // --- From sections/Maintenance.tsx ---
      const Maintenance = () => {
          const { data, updateData } = useData();
          const { userRole } = useAuth();
          const isAdmin = userRole === 'admin';

          const handleAddNumber = () => {
              const area = prompt("أدخل اسم المنطقة:");
              if (area) {
                  const number = prompt(`أدخل الرقم للمنطقة ${area}:`);
                  if (number) {
                      const newNumbers = [...data.maintenanceNumbers, { area, number }];
                      updateData({ ...data, maintenanceNumbers: newNumbers });
                  }
              }
          };

          const handleEditNumber = (index) => {
              const item = data.maintenanceNumbers[index];
              const newArea = prompt("تعديل اسم المنطقة:", item.area);
              if (newArea) {
                  const newNumber = prompt(`تعديل الرقم للمنطقة ${newArea}:`, item.number);
                  if (newNumber) {
                      const newNumbers = [...data.maintenanceNumbers];
                      newNumbers[index] = { area: newArea, number: newNumber };
                      updateData({ ...data, maintenanceNumbers: newNumbers });
                  }
              }
          };

          const handleDeleteNumber = (index) => {
              if (window.confirm("هل أنت متأكد من حذف هذا الرقم؟")) {
                  const newNumbers = [...data.maintenanceNumbers];
                  newNumbers.splice(index, 1);
                  updateData({ ...data, maintenanceNumbers: newNumbers });
              }
          };

          const handleAddSticker = () => {
              const name = prompt("أدخل اسم الستيكر:");
              if (name) {
                  const thumb = prompt(`أدخل رابط الصورة المصغرة للستيكر ${name}:`);
                  if (thumb) {
                      const newStickers = [...data.stickers, { name, thumb }];
                      updateData({ ...data, stickers: newStickers });
                  }
              }
          };

          const handleEditSticker = (index) => {
              const item = data.stickers[index];
              const newName = prompt("تعديل اسم الستيكر:", item.name);
              if (newName) {
                  const newThumb = prompt(`تعديل رابط الصورة للستيكر ${newName}:`, item.thumb);
                  if (newThumb) {
                      const newStickers = [...data.stickers];
                      newStickers[index] = { name: newName, thumb: newThumb };
                      updateData({ ...data, stickers: newStickers });
                  }
              }
          };

          const handleDeleteSticker = (index) => {
              if (window.confirm("هل أنت متأكد من حذف هذا الستيكر؟")) {
                  const newStickers = [...data.stickers];
                  newStickers.splice(index, 1);
                  updateData({ ...data, stickers: newStickers });
              }
          };


          return (
              <section className="container mx-auto px-4 py-12 animate-fade-in">
                  <div className="flex justify-center items-center mb-12">
                      <h2 className="text-3xl font-bold text-center text-slate-800 relative after:content-[''] after:absolute after:w-20 after:h-1 after:bg-blue-500 after:left-1/2 after:-translate-x-1/2 after:bottom-[-10px] after:rounded-full">أرقام هواتف الصيانة</h2>
                      {isAdmin && <button onClick={handleAddNumber} className="mr-6 px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600"><i className="fas fa-plus"></i></button>}
                  </div>
                  <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
                      {data.maintenanceNumbers.map((item, index) => (
                          <div key={index} className="bg-white p-6 rounded-lg shadow-md text-center transform hover:-translate-y-1 transition-transform duration-300 group relative">
                               {isAdmin && (
                                  <div className="absolute top-2 right-2 z-10 flex gap-2">
                                      <button onClick={() => handleEditNumber(index)} className="w-7 h-7 bg-yellow-400 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity" title="تعديل"><i className="fas fa-pen text-xs"></i></button>
                                      <button onClick={() => handleDeleteNumber(index)} className="w-7 h-7 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity" title="حذف"><i className="fas fa-trash-alt text-xs"></i></button>
                                  </div>
                              )}
                              <h3 className="text-lg font-bold text-slate-800 mb-2">{item.area}</h3>
                              <p className="text-2xl font-extrabold text-blue-500 tracking-wider">{item.number}</p>
                          </div>
                      ))}
                  </div>

                  <div className="flex justify-center items-center mt-20 mb-12">
                       <h2 className="text-3xl font-bold text-center text-slate-800 relative after:content-[''] after:absolute after:w-20 after:h-1 after:bg-blue-500 after:left-1/2 after:-translate-x-1/2 after:bottom-[-10px] after:rounded-full">ستيكرات المناطق</h2>
                       {isAdmin && <button onClick={handleAddSticker} className="mr-6 px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600"><i className="fas fa-plus"></i></button>}
                  </div>
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
                       {data.stickers.map((sticker, index) => (
                          <div key={index} className="bg-white p-4 rounded-lg shadow-md text-center transform hover:-translate-y-1 transition-transform duration-300 group relative">
                              {isAdmin && (
                                  <div className="absolute top-2 right-2 z-10 flex gap-2">
                                      <button onClick={() => handleEditSticker(index)} className="w-7 h-7 bg-yellow-400 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity" title="تعديل"><i className="fas fa-pen text-xs"></i></button>
                                      <button onClick={() => handleDeleteSticker(index)} className="w-7 h-7 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity" title="حذف"><i className="fas fa-trash-alt text-xs"></i></button>
                                  </div>
                              )}
                              <a href={sticker.thumb} target="_blank" rel="noopener noreferrer">
                                  <img src={sticker.thumb} alt={sticker.name} className="w-24 h-24 object-cover rounded-full mx-auto mb-4 border-4 border-slate-200" />
                                  <p className="font-semibold text-slate-700">{sticker.name}</p>
                              </a>
                          </div>
                      ))}
                  </div>
              </section>
          );
      };
      
      // --- From sections/Columns.tsx ---
      const PoleItem = ({ pole, areaName, zoneNumber, onDelete }) => {
          const { updateField, data } = useData();
          const { userRole } = useAuth();
          const canEdit = userRole === 'admin' || userRole === 'follower';
          const isAdmin = userRole === 'admin';

          const areaIndex = data.columns.areas.findIndex(a => a.name === areaName);
          const zoneIndex = data.columns.areas[areaIndex]?.zones.findIndex(z => z.number === zoneNumber);
          const poleIndex = data.columns.areas[areaIndex]?.zones[zoneIndex]?.poles.findIndex(p => p.number === pole.number);
          const basePath = `columns.areas.${areaIndex}.zones.${zoneIndex}.poles.${poleIndex}`;

          const handleCountChange = (type, amount) => {
              const currentValue = pole[type];
              if (currentValue + amount >= 0) {
                  updateField(`${basePath}.${type}`, currentValue + amount);
              }
          };
          
          const handleNotesChange = (e) => {
              updateField(`${basePath}.notes`, e.target.value);
          };

          return (
              <div className="bg-white rounded-lg shadow-md p-4 flex flex-col md:flex-row gap-4 relative group">
                  {isAdmin && (
                      <button onClick={onDelete} className="absolute top-2 left-2 w-7 h-7 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-10" title="حذف العمود">
                          <i className="fas fa-trash-alt text-xs"></i>
                      </button>
                  )}
                  <div className="flex-shrink-0 md:w-1/3">
                      <h4 className="text-lg font-bold text-slate-800 mb-3 border-b pb-2">عمود {pole.number}</h4>
                      <div className="space-y-3">
                          <div className="flex justify-between items-center">
                              <span className="font-semibold">المتصلين:</span>
                              <div className="flex items-center gap-2">
                                  <button onClick={() => handleCountChange('connected', -1)} disabled={!canEdit} className="w-7 h-7 bg-red-100 text-red-600 rounded-full disabled:opacity-50 disabled:cursor-not-allowed">-</button>
                                  <span className="w-8 text-center font-bold text-lg">{pole.connected}</span>
                                  <button onClick={() => handleCountChange('connected', 1)} disabled={!canEdit} className="w-7 h-7 bg-green-100 text-green-600 rounded-full disabled:opacity-50 disabled:cursor-not-allowed">+</button>
                              </div>
                          </div>
                          <div className="flex justify-between items-center">
                              <span className="font-semibold">المنتقلين:</span>
                               <div className="flex items-center gap-2">
                                  <button onClick={() => handleCountChange('moved', -1)} disabled={!canEdit} className="w-7 h-7 bg-red-100 text-red-600 rounded-full disabled:opacity-50 disabled:cursor-not-allowed">-</button>
                                  <span className="w-8 text-center font-bold text-lg">{pole.moved}</span>
                                  <button onClick={() => handleCountChange('moved', 1)} disabled={!canEdit} className="w-7 h-7 bg-green-100 text-green-600 rounded-full disabled:opacity-50 disabled:cursor-not-allowed">+</button>
                              </div>
                          </div>
                      </div>
                  </div>
                  <div className="flex-grow">
                      <textarea
                          placeholder="ملاحظات..."
                          value={pole.notes}
                          onChange={handleNotesChange}
                          readOnly={!canEdit}
                          className="w-full h-full min-h-[80px] p-2 bg-slate-50 border rounded-md resize-none disabled:cursor-not-allowed"
                          disabled={!canEdit}
                      />
                  </div>
              </div>
          );
      };

      const Columns = () => {
          const { data, updateData } = useData();
          const { userRole } = useAuth();
          const isAdmin = userRole === 'admin';
          const [search, setSearch] = useState('');
          const [selectedArea, setSelectedArea] = useState(null);
          const [selectedZone, setSelectedZone] = useState(null);

          const handleAddArea = () => {
              const name = prompt("أدخل اسم المنطقة الجديدة:");
              if (name && !data.columns.areas.some(a => a.name === name)) {
                  const newArea = { name, zones: [] };
                  updateData({ ...data, columns: { ...data.columns, areas: [...data.columns.areas, newArea] } });
              } else if (name) {
                  alert("اسم المنطقة موجود بالفعل.");
              }
          };

          const handleDeleteArea = (areaName) => {
              if (window.confirm(`هل أنت متأكد من حذف منطقة "${areaName}" وكل ما تحتويه؟`)) {
                  const newAreas = data.columns.areas.filter(a => a.name !== areaName);
                  updateData({ ...data, columns: { ...data.columns, areas: newAreas } });
                  if (selectedArea?.name === areaName) {
                      setSelectedArea(newAreas[0] || null);
                      setSelectedZone(newAreas[0]?.zones[0] || null);
                  }
              }
          };

          const handleAddZone = () => {
              if (!selectedArea) return;
              const number = prompt(`أدخل رقم الزون الجديد لمنطقة "${selectedArea.name}":`);
              if (number && !selectedArea.zones.some(z => z.number === number)) {
                  const newZone = { number, poles: [] };
                  const newAreas = data.columns.areas.map(a => a.name === selectedArea.name ? { ...a, zones: [...a.zones, newZone] } : a);
                  updateData({ ...data, columns: { ...data.columns, areas: newAreas } });
              } else if (number) {
                  alert("رقم الزون موجود بالفعل في هذه المنطقة.");
              }
          };
          
          const handleDeleteZone = (zoneNumber) => {
              if (!selectedArea) return;
              if (window.confirm(`هل أنت متأكد من حذف الزون "${zoneNumber}" وكل أعمدته؟`)) {
                  const newZones = selectedArea.zones.filter(z => z.number !== zoneNumber);
                  const newAreas = data.columns.areas.map(a => a.name === selectedArea.name ? { ...a, zones: newZones } : a);
                  updateData({ ...data, columns: { ...data.columns, areas: newAreas } });
                   if (selectedZone?.number === zoneNumber) {
                      setSelectedZone(newZones[0] || null);
                  }
              }
          };

          const handleAddPole = () => {
              if (!selectedArea || !selectedZone) return;
              const poleNumStr = prompt(`أدخل رقم العمود الجديد في زون "${selectedZone.number}":`);
              if (poleNumStr) {
                  const number = parseInt(poleNumStr);
                  if (!isNaN(number) && !selectedZone.poles.some(p => p.number === number)) {
                      const newPole = { number, connected: 0, moved: 0, notes: '' };
                      const newPoles = [...selectedZone.poles, newPole].sort((a,b) => a.number - b.number);
                      const newZones = selectedArea.zones.map(z => z.number === selectedZone.number ? { ...z, poles: newPoles } : z);
                      const newAreas = data.columns.areas.map(a => a.name === selectedArea.name ? { ...a, zones: newZones } : a);
                      updateData({ ...data, columns: { ...data.columns, areas: newAreas } });
                  } else {
                       alert("رقم العمود غير صالح أو موجود بالفعل.");
                  }
              }
          };

          const handleDeletePole = (poleNumber) => {
               if (!selectedArea || !selectedZone) return;
               if (window.confirm(`هل أنت متأكد من حذف العمود "${poleNumber}"؟`)) {
                  const newPoles = selectedZone.poles.filter(p => p.number !== poleNumber);
                  const newZones = selectedZone.poles.map(z => z.number === selectedZone.number ? { ...z, poles: newPoles } : z);
                  const newAreas = data.columns.areas.map(a => a.name === selectedArea.name ? { ...a, zones: newZones } : a);
                  updateData({ ...data, columns: { ...data.columns, areas: newAreas } });
               }
          };


          useEffect(() => {
              const currentAreaExists = data.columns.areas.some(a => a.name === selectedArea?.name);
              if (!currentAreaExists && data.columns.areas.length > 0) {
                  setSelectedArea(data.columns.areas[0]);
              } else if (data.columns.areas.length === 0) {
                  setSelectedArea(null);
              }
          }, [data.columns.areas, selectedArea?.name]);

          useEffect(() => {
              if (selectedArea) {
                  const currentZoneExists = selectedArea.zones.some(z => z.number === selectedZone?.number);
                  if (!currentZoneExists && selectedArea.zones.length > 0) {
                      setSelectedZone(selectedArea.zones[0]);
                  } else if (selectedArea.zones.length === 0) {
                      setSelectedZone(null);
                  }
              } else {
                  setSelectedZone(null);
              }
          }, [selectedArea, selectedZone?.number]);
          
          useEffect(() => {
              if (search.includes('-')) {
                  const [zoneNum, poleNumStr] = search.split('-');
                  const poleNum = parseInt(poleNumStr);

                  if (zoneNum && !isNaN(poleNum)) {
                      for (const area of data.columns.areas) {
                          const foundZone = area.zones.find(z => z.number === zoneNum);
                          if (foundZone) {
                              const foundPole = foundZone.poles.find(p => p.number === poleNum);
                              if (foundPole) {
                                  setSelectedArea(area);
                                  setSelectedZone(foundZone);
                                  break;
                              }
                          }
                      }
                  }
              }
          }, [search, data.columns.areas]);


          return (
              <section className="container mx-auto px-4 py-12 animate-fade-in">
                   <h2 className="text-3xl font-bold text-center mb-12 text-slate-800 relative after:content-[''] after:absolute after:w-20 after:h-1 after:bg-blue-500 after:left-1/2 after:-translate-x-1/2 after:bottom-[-10px] after:rounded-full">الأعمدة</h2>

                  <div className="max-w-md mx-auto mb-8 relative">
                      <input
                          type="text"
                          placeholder="ابحث عن عمود (مثال: 50-1)"
                          value={search}
                          onChange={e => setSearch(e.target.value)}
                          className="w-full p-3 pl-10 border-2 border-slate-300 rounded-lg"
                      />
                       <i className="fas fa-search absolute right-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                  </div>
                  
                  <div className="flex flex-col lg:flex-row gap-8">
                      {/* Areas Sidebar */}
                      <aside className="lg:w-1/4 bg-white p-4 rounded-lg shadow-md h-fit">
                          <div className="flex justify-between items-center mb-4">
                              <h3 className="text-xl font-bold text-slate-800">المناطق</h3>
                              {isAdmin && <button onClick={handleAddArea} className="w-8 h-8 bg-green-500 text-white rounded-md hover:bg-green-600 flex items-center justify-center"><i className="fas fa-plus"></i></button>}
                          </div>
                          <ul className="space-y-1">
                              {data.columns.areas.map(area => (
                                  <li key={area.name} className="flex items-center group">
                                      <button onClick={() => {setSelectedArea(area); setSelectedZone(area.zones[0] || null);}} className={`w-full text-right px-4 py-2 rounded-md transition-colors ${selectedArea?.name === area.name ? 'bg-blue-500 text-white' : 'hover:bg-slate-100'}`}>
                                          {area.name}
                                      </button>
                                      {isAdmin && <button onClick={() => handleDeleteArea(area.name)} className="mr-2 text-red-500 opacity-0 group-hover:opacity-100"><i className="fas fa-trash-alt"></i></button>}
                                  </li>
                              ))}
                          </ul>
                      </aside>

                      {/* Zones and Poles */}
                      <main className="lg:w-3/4">
                          {selectedArea ? (
                              <div className="bg-white p-4 rounded-lg shadow-md">
                                   <div className="flex justify-between items-center mb-4">
                                      <h3 className="text-xl font-bold text-slate-800">زونات منطقة {selectedArea.name}</h3>
                                      {isAdmin && <button onClick={handleAddZone} className="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 flex items-center gap-2"><i className="fas fa-plus"></i><span>إضافة زون</span></button>}
                                  </div>
                                  <div className="flex flex-wrap gap-2 mb-6 border-b pb-6">
                                      {selectedArea.zones.map(zone => (
                                          <div key={zone.number} className="relative group">
                                              <button onClick={() => setSelectedZone(zone)} className={`px-4 py-2 rounded-md font-semibold transition-colors ${selectedZone?.number === zone.number ? 'bg-slate-800 text-white' : 'bg-slate-200 hover:bg-slate-300'}`}>
                                                  {zone.number}
                                              </button>
                                               {isAdmin && <button onClick={() => handleDeleteZone(zone.number)} className="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"><i className="fas fa-times"></i></button>}
                                          </div>
                                      ))}
                                  </div>

                                  {selectedZone && (
                                      <>
                                       <div className="flex justify-between items-center mb-4">
                                          <h3 className="text-xl font-bold text-slate-800">أعمدة زون {selectedZone.number}</h3>
                                          {isAdmin && <button onClick={handleAddPole} className="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 flex items-center gap-2"><i className="fas fa-plus"></i><span>إضافة عمود</span></button>}
                                      </div>
                                      <div className="space-y-4">
                                          {selectedZone.poles
                                            .slice()
                                            .sort((a, b) => a.number - b.number)
                                            .map(pole => <PoleItem key={pole.number} pole={pole} areaName={selectedArea.name} zoneNumber={selectedZone.number} onDelete={() => handleDeletePole(pole.number)} />
                                          )}
                                      </div>
                                      </>
                                  )}
                                   {!selectedZone && selectedArea.zones.length > 0 && <p className="text-center text-slate-500 py-8">الرجاء اختيار زون لعرض الأعمدة.</p>}
                                   {selectedArea.zones.length === 0 && <p className="text-center text-slate-500 py-8">لا توجد زونات في هذه المنطقة. قم بإضافة زون جديد.</p>}
                              </div>
                          ) : (
                               <div className="bg-white p-8 rounded-lg shadow-md text-center">
                                  <p className="text-slate-500">الرجاء اختيار منطقة من القائمة.</p>
                               </div>
                          )}
                      </main>
                  </div>
              </section>
          );
      };
      
      // --- From sections/Contact.tsx ---
      const Contact = () => {
          return (
              <section className="container mx-auto px-4 py-12 animate-fade-in">
                  <div className="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-8 text-center">
                      <h2 className="text-3xl font-bold text-center mb-4 text-slate-800">تواصل معنا</h2>
                      <p className="text-slate-600 mb-8">يسعدنا تواصلكم معنا عبر التطبيقات التالية:</p>
                      
                      <div className="flex justify-center gap-12">
                          <a href="https://instagram.com/alitaha.98" target="_blank" rel="noopener noreferrer" className="flex flex-col items-center gap-3 group">
                              <div className="w-20 h-20 rounded-full flex items-center justify-center text-4xl text-white bg-gradient-to-br from-yellow-400 via-red-500 to-purple-600 group-hover:scale-110 transition-transform">
                                  <i className="fab fa-instagram"></i>
                              </div>
                              <span className="font-semibold text-slate-700">حساب الإنستغرام</span>
                          </a>
                          <a href="https://wa.me/+9647759313075" target="_blank" rel="noopener noreferrer" className="flex flex-col items-center gap-3 group">
                              <div className="w-20 h-20 rounded-full flex items-center justify-center text-4xl text-white bg-gradient-to-br from-green-400 to-teal-600 group-hover:scale-110 transition-transform">
                                  <i className="fab fa-whatsapp"></i>
                              </div>
                              <span className="font-semibold text-slate-700">واتساب الدعم الفني</span>
                          </a>
                      </div>
                  </div>
              </section>
          );
      };

      // --- From App.tsx ---
      const App = () => {
        const { userRole } = useAuth();
        const [activeSection, setActiveSection] = useState(Section.Home);

        useEffect(() => {
          if (userRole) {
            document.body.classList.add('logged-in');
          } else {
            document.body.classList.remove('logged-in');
          }
        }, [userRole]);

        if (!userRole) {
          return <Login />;
        }

        const renderSection = () => {
          switch (activeSection) {
            case Section.Home:
              return <Home setActiveSection={setActiveSection} />;
            case Section.Maps:
              return <Maps />;
            case Section.Offers:
              return <Offers />;
            case Section.Vlans:
              return <Vlans />;
            case Section.Materials:
              return <Materials />;
            case Section.Maintenance:
              return <Maintenance />;
            case Section.Columns:
              return <Columns />;
            case Section.Contact:
              return <Contact />;
            default:
              return <Home setActiveSection={setActiveSection} />;
          }
        };

        return (
          <div className="main-wrapper block bg-gradient-to-br from-slate-100 to-slate-200 text-slate-800 min-h-screen">
            <Layout activeSection={activeSection} setActiveSection={setActiveSection}>
              {renderSection()}
            </Layout>
          </div>
        );
      };

      // --- From index.tsx ---
      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }

      const root = ReactDOM.createRoot(rootElement);
      root.render(
        <React.StrictMode>
          <AuthProvider>
            <DataProvider>
              <App />
            </DataProvider>
          </AuthProvider>
        </React.StrictMode>
      );
    </script>
</body>
</html>
